<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#37558C">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Gatherly - Plan Your Week</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='favicon-192x192.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container" style="opacity: 0; transition: opacity 0.2s ease;">
        <!-- Header with Logo and Settings -->
        <div class="header-row">
            <div class="title-logo">
                <div class="app-logo"></div>
                <span>Gatherly</span>
            </div>
            <button class="settings-btn" onclick="openSettings()">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>
        </div>

        <!-- Status Message -->
        <div id="statusMessage" style="display: none;"></div>

        <!-- Friends Section -->
        <div class="friends-section">
            <div class="friends-list-wrapper" id="friendsListWrapper">
                <div class="friends-list" id="friendsList">
                </div>
            </div>
            <div class="active-status" id="activeStatus"></div>
        </div>

        <!-- Calendar Section -->
        <div class="calendar-section">
            <div class="calendar">
                <div class="calendar-header" id="calendarHeader">
                    <!-- Dynamically generated -->
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Dynamically generated -->
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <button class="nav-item" onclick="openManageFriendsModal()">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <line x1="19" y1="8" x2="19" y2="14"></line>
                    <line x1="22" y1="11" x2="16" y2="11"></line>
                </svg>
                <span>Friends</span>
            </button>
            <button class="nav-item" onclick="openNotifications()">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
                <span>Notifications</span>
                <span class="nav-badge" id="notificationBadgeNav" style="display: none;">0</span>
            </button>
            <button class="nav-item" onclick="openPlans()">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span>Plans</span>
                <span class="nav-badge" id="plansBadgeNav" style="display: none;">0</span>
            </button>
        </div>

    </div>

    <!-- Slot Popup Menu -->
    <div class="slot-popup" id="slotPopup">
        <button class="slot-popup-option" id="popupToggleAvailability" onclick="toggleSlotFromPopup()">
            <span id="popupToggleText">Add availability</span>
        </button>
        <div class="slot-popup-divider"></div>
        <button class="slot-popup-option" id="popupPlan" onclick="openPlanModal()">
            Plan
        </button>
    </div>

    <!-- Plan Modal -->
    <div class="modal" id="planModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="planModalTitle">Plan a Hangout</h2>
                <button class="close-btn" onclick="closePlanModal()">&times;</button>
            </div>
            <div class="plan-modal-body">
                <!-- Slot info shown when coming from calendar -->
                <div class="plan-slot-info" id="planSlotInfo"></div>
                
                <!-- Date/time pickers shown when creating new plan -->
                <div class="plan-datetime-section" id="planDatetimeSection" style="display: none;">
                    <div class="plan-section">
                        <div class="plan-section-header">When?</div>
                        <input type="date" class="form-input plan-date-input" id="planDateInput">
                        <div class="plan-time-buttons" id="planTimeButtons">
                            <button type="button" class="time-btn" data-time="morning" onclick="selectPlanTime('morning')">Morning</button>
                            <button type="button" class="time-btn" data-time="afternoon" onclick="selectPlanTime('afternoon')">Afternoon</button>
                            <button type="button" class="time-btn" data-time="evening" onclick="selectPlanTime('evening')">Evening</button>
                        </div>
                    </div>
                </div>
                
                <div class="plan-section">
                    <div class="plan-section-header" id="planFriendsHeader">Who's available?</div>
                    <div class="plan-friends-list" id="planFriendsList"></div>
                </div>
                
                <div class="plan-section">
                    <div class="plan-section-header">Add a message (optional)</div>
                    <textarea class="form-input plan-message" id="planMessage" placeholder="What's the plan? e.g., Grab dinner at 7pm"></textarea>
                </div>
                
                <button class="btn-primary" id="sendInviteBtn" onclick="sendHangoutInvite()">
                    Send Invite
                </button>
            </div>
        </div>
    </div>

    <!-- Setup Modal -->
    <div class="modal" id="setupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Welcome to Gatherly!</h2>
            </div>
            <form onsubmit="setupPlanner(event)">
                <div class="form-group">
                    <label class="form-label">First Name</label>
                    <input type="text" class="form-input" id="plannerFirstName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Last Name</label>
                    <input type="text" class="form-input" id="plannerLastName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Your Phone Number</label>
                    <input type="tel" class="form-input" id="plannerPhone" placeholder="1234567890" required>
                </div>
                <button type="submit" class="btn-primary">Get Started</button>
            </form>
        </div>
    </div>

    <!-- Manage Friends Modal -->
    <div class="modal" id="manageFriendsModal">
        <div class="modal-content">
            <!-- List View -->
            <div id="manageFriendsListView">
                <div class="modal-header">
                    <h2 class="modal-title">Manage Friends</h2>
                    <button class="close-btn" onclick="closeManageFriendsModal()">×</button>
                </div>
                <button class="btn-add-friend" onclick="showAddFriendView()">
                    <span class="plus-icon">+</span> Add New Friend
                </button>
                <div class="friends-manage-list" id="friendsManageList">
                    <!-- Friends will be populated here -->
                </div>
            </div>
            
            <!-- Add Friend View -->
            <div id="manageFriendsAddView" style="display: none;">
                <div class="modal-header">
                    <button class="back-btn" onclick="showFriendsListView()">←</button>
                    <h2 class="modal-title">Add Friend</h2>
                    <button class="close-btn" onclick="closeManageFriendsModal()">×</button>
                </div>
                <form onsubmit="addFriendFromManage(event)">
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" id="manageFriendPhone" placeholder="1234567890" required>
                        <p class="form-hint">Enter their phone number to find them</p>
                    </div>
                    <button type="submit" class="btn-primary">Add Friend</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div class="modal" id="notificationsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Notifications</h2>
                <button class="close-btn" onclick="closeNotifications()">×</button>
            </div>
            <div class="notifications-list" id="notificationsList">
                <!-- Notifications will be populated here -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Account Settings</h2>
                <button class="close-btn" onclick="closeSettings()">×</button>
            </div>
            <div class="settings-content">
                <div class="settings-section">
                    <h3 class="settings-section-title">Account Information</h3>
                    <div class="account-info" id="accountInfo">
                        <!-- Account details will be populated here -->
                    </div>
                    <div class="form-buttons">
                        <button class="btn-secondary" onclick="editAccount()">Edit Account</button>
                        <button class="btn-secondary" onclick="logout()">Logout</button>
                    </div>
                </div>
                <div class="settings-section">
                    <h3 class="settings-section-title">Timezone</h3>
                    <p class="settings-description">Your timezone is auto-detected. Update if incorrect.</p>
                    <div class="form-group">
                        <label class="form-label">Timezone</label>
                        <select class="form-input" id="timezoneSelect">
                            <option value="America/New_York">Eastern Time (ET)</option>
                            <option value="America/Chicago">Central Time (CT)</option>
                            <option value="America/Denver">Mountain Time (MT)</option>
                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                            <option value="America/Anchorage">Alaska Time (AKT)</option>
                            <option value="Pacific/Honolulu">Hawaii Time (HST)</option>
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button type="button" class="btn-primary" onclick="saveTimezone()">Save Timezone</button>
                    </div>
                </div>
                <div class="settings-section">
                    <h3 class="settings-section-title">Availability Notifications</h3>
                    <p class="settings-description">Get notified when selected friends update their availability.</p>
                    <div class="notification-friends" id="notificationFriendsList">
                        <!-- Friend bubbles will be populated here -->
                    </div>
                    <p class="settings-hint" id="noLinkedFriendsHint" style="display: none;">No linked friends yet. Add friends to get notified when they're available!</p>
                    <div class="form-buttons">
                        <button type="button" class="btn-primary" onclick="saveNotificationPreferences()">Save Preferences</button>
                    </div>
                </div>
                <div class="settings-section" id="pushNotificationSection">
                    <h3 class="settings-section-title">Push Notifications</h3>
                    <p class="settings-description">Get instant notifications when friends update their availability or invite you to hang out.</p>
                    <div id="pushStatus"></div>
                    <div id="pushNotEnabled" style="display: none;">
                        <div class="form-buttons">
                            <button type="button" class="btn-primary" id="enablePushBtn" onclick="enablePushFromSettings()">Enable Notifications</button>
                        </div>
                    </div>
                    <div id="pushEnabled" style="display: none;">
                        <div class="toggle-row">
                            <label class="toggle-label">Push notifications</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pushToggle" checked onchange="togglePushNotifications()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="form-buttons" style="margin-top: 12px;">
                            <button type="button" class="btn-secondary" id="testPushBtn" onclick="testPushNotification()">Send Test</button>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3 class="settings-section-title">Weekly Reminders</h3>
                    <p class="settings-description">Get a Sunday evening reminder to share your availability for the week.</p>
                    <div class="toggle-row">
                        <label class="toggle-label" for="weeklyRemindersToggle">Enable weekly reminders</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="weeklyRemindersToggle" onchange="saveWeeklyReminders()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-section">
                    <h3 class="settings-section-title">Feedback</h3>
                    <p class="settings-description">We'd love to hear your thoughts, suggestions, or report any issues. Send us an email at:</p>
                    <p style="font-size: 16px; color: var(--accent-mint); font-weight: 500; margin-top: 12px;">
                        <a href="mailto:hello@trygatherly.com" style="color: var(--accent-mint); text-decoration: none;">hello@trygatherly.com</a>
                    </p>
                </div>
                <div class="settings-section danger-zone">
                    <h3 class="settings-section-title">Danger Zone</h3>
                    <p class="settings-warning">Deleting your account will permanently remove all your data, including plans and contacts.</p>
                    <button class="btn-danger" onclick="confirmDeleteAccount()">Delete Account</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Account Modal -->
    <div class="modal" id="editAccountModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Account</h2>
                <button class="close-btn" onclick="closeEditAccount()">×</button>
            </div>
            <form onsubmit="updateAccount(event)">
                <div class="form-group">
                    <label class="form-label">First Name</label>
                    <input type="text" class="form-input" id="editFirstName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Last Name</label>
                    <input type="text" class="form-input" id="editLastName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" id="editPhone" placeholder="1234567890" required>
                </div>
                <div class="form-buttons">
                    <button type="button" class="btn-secondary" onclick="closeEditAccount()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Plans Modal -->
    <div class="modal" id="plansModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">My Plans</h2>
                <button class="close-btn" onclick="closePlans()">×</button>
            </div>
            <button class="btn-primary new-plan-btn" onclick="openNewPlanModal()">+ New Plan</button>
            <div class="plans-list" id="plansList">
                <!-- Plans will be populated here -->
            </div>
        </div>
    </div>

    <!-- Plan Detail Modal -->
    <div class="modal" id="planDetailModal">
        <div class="modal-content plan-detail-modal">
            <div class="plan-detail-header-bar" id="planDetailHeaderBar">
                <button class="back-btn" onclick="backToPlans()">←</button>
                <div class="plan-detail-title-info" id="planDetailTitleInfo">
                    <!-- Title · Date · Time -->
                </div>
                <button class="plan-options-btn" id="planOptionsBtn" onclick="togglePlanOptions()">•••</button>
            </div>
            <div class="plan-options-menu" id="planOptionsMenu">
                <!-- Options will be populated here -->
            </div>
            <div class="plan-detail-content" id="planDetailContent">
                <!-- Plan details will be populated here -->
            </div>
        </div>
    </div>

    <!-- Add to Home Screen Popup (iOS) -->
    <div class="install-popup-overlay" id="installPopupOverlay" onclick="closeInstallPopup()"></div>
    <div class="install-popup" id="installPopup">
        <button class="install-popup-close" onclick="closeInstallPopup()">&times;</button>
        <h3 class="install-popup-title">Add Gatherly to Home Screen</h3>
        <p class="install-popup-subtitle">For the best experience, add Gatherly to your home screen.</p>
        <div class="install-steps">
            <div class="install-step">
                <span class="step-number">1.</span>
                <span>Tap the <strong>Share</strong> button <img src="/static/icons/share.PNG" alt="Share" class="share-icon"> in your browser</span>
            </div>
            <div class="install-step">
                <span class="step-number">2.</span>
                <span>Scroll down and tap <strong>Add to Home Screen</strong></span>
            </div>
            <div class="install-step">
                <span class="step-number">3.</span>
                <span>Tap <strong>Add</strong> in the top-right corner</span>
            </div>
        </div>
        <button class="install-popup-btn" onclick="closeInstallPopup()">Got it!</button>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>

